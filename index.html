<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é™ï¼Œç»™ä½ çš„ä¸€å°ä¿¡</title>
  <meta name="description" content="æƒ…äººèŠ‚æƒ…ä¹¦ï¼ˆæˆç†Ÿæ¸©æŸ”ç‰ˆï¼‰" />

  <!-- Optional: more handwritten feel -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0f1020;
      --bg2:#1b1630;
      --text:#f6f2ff;
      --muted:#d8cfffcc;
      --stroke:#ffffff1a;
      --card:#ffffff10;
      --accent:#ff6b9a;
      --accent2:#ffd1dc;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 28px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei","Noto Sans SC",system-ui,sans-serif;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,107,154,.18), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(255,209,220,.14), transparent 60%),
        radial-gradient(1100px 900px at 50% 90%, rgba(130,140,255,.10), transparent 60%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Photo background layer */
    .photo-bg{
      position:fixed; inset:0;
      background-image: url("photo.jpg");
      background-size: cover;
      background-position: center;
      opacity:.16;
      filter: blur(2px) saturate(1.05);
      transform: scale(1.06);
      pointer-events:none;
    }
    .photo-vignette{
      position:fixed; inset:0;
      background:
        radial-gradient(1200px 700px at 50% 30%, transparent 30%, rgba(0,0,0,.45) 75%),
        linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35));
      pointer-events:none;
    }

    /* subtle grain */
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.20'/%3E%3C/svg%3E");
      opacity:.08;
      mix-blend-mode:overlay;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px 18px;
      position:relative;
      z-index:1;
    }

    /* ===== Envelope Scene ===== */
    .scene{
      width:min(940px, 100%);
      display:grid;
      place-items:center;
      gap:18px;
    }

    .hint{
      color:rgba(216,207,255,.78);
      font-size:14px;
      text-align:center;
      line-height:1.7;
    }

    .envelope-wrap{
      width:min(520px, 92vw);
      aspect-ratio: 16 / 10;
      position:relative;
      display:grid;
      place-items:center;
      user-select:none;
      cursor:pointer;
      perspective: 1200px;
    }

    .envelope{
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      filter: drop-shadow(0 24px 50px rgba(0,0,0,.45));
    }

    /* base body */
    .env-body{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);
      overflow:hidden;
    }

    /* inside lining */
    .env-body:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(400px 180px at 25% 20%, rgba(255,107,154,.16), transparent 60%),
        radial-gradient(420px 220px at 80% 25%, rgba(255,209,220,.14), transparent 65%);
      opacity:.9;
    }

    /* top flap */
    .flap{
      position:absolute;
      left:0; right:0;
      top:-1px;
      height:56%;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform 900ms cubic-bezier(.2,.9,.2,1);
      z-index:4;
    }
    .flap:before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);
      border-bottom:none;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      border-top-left-radius:18px;
      border-top-right-radius:18px;
    }

    /* side folds (simple triangles) */
    .fold-left, .fold-right, .fold-bottom{
      position:absolute; inset:0;
      z-index:2;
    }
    .fold-left:before{
      content:"";
      position:absolute; inset:0;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      clip-path: polygon(0 0, 55% 50%, 0 100%);
      border-radius:18px;
    }
    .fold-right:before{
      content:"";
      position:absolute; inset:0;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      clip-path: polygon(100% 0, 45% 50%, 100% 100%);
      border-radius:18px;
    }
    .fold-bottom:before{
      content:"";
      position:absolute; inset:0;
      background: rgba(0,0,0,.10);
      border:1px solid rgba(255,255,255,.10);
      clip-path: polygon(0 100%, 50% 40%, 100% 100%);
      border-radius:18px;
    }

    /* wax seal */
    .seal{
      position:absolute;
      width:84px; height:84px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.24), transparent 38%),
                  linear-gradient(135deg, rgba(255,107,154,.9), rgba(255,209,220,.55));
      box-shadow: 0 14px 30px rgba(255,107,154,.18);
      border:1px solid rgba(255,107,154,.35);
      display:grid;
      place-items:center;
      z-index:5;
      transform: translateY(14px);
      transition: transform 900ms cubic-bezier(.2,.9,.2,1), opacity 500ms ease;
    }
    .seal span{
      font-weight:800;
      color:#1b1020;
      letter-spacing:2px;
      opacity:.92;
    }

    /* letter that slides out */
    .paper{
      position:absolute;
      width:92%;
      height:86%;
      left:4%;
      bottom:6%;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.16);
      transform: translateY(28%) translateZ(0);
      transition: transform 1000ms cubic-bezier(.2,.95,.2,1), opacity 600ms ease;
      z-index:3;
      overflow:hidden;
    }
    .paper:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(500px 240px at 20% 0%, rgba(255,107,154,.12), transparent 60%),
        radial-gradient(480px 240px at 85% 10%, rgba(255,209,220,.10), transparent 65%);
      opacity:.9;
      pointer-events:none;
    }
    .paper .paper-title{
      padding:16px 16px 8px;
      font-weight:800;
      letter-spacing:.8px;
      color:rgba(246,242,255,.92);
    }
    .paper .paper-line{
      padding:0 16px 8px;
      color:rgba(216,207,255,.80);
      font-size:13px;
      line-height:1.6;
    }

    /* Open state */
    .open .flap{
      transform: rotateX(-165deg);
    }
    .open .paper{
      transform: translateY(-8%) translateZ(0);
    }
    .open .seal{
      transform: translateY(44px) scale(.92);
      opacity:0;
      pointer-events:none;
    }

    /* ===== Letter Card ===== */
    .card{
      width:min(860px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(10px);
      transform: translateY(10px);
      opacity:0;
      pointer-events:none;
      transition: opacity 700ms ease, transform 700ms ease;
    }
    .card.show{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }
    .card:after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 240px at 20% 0%, rgba(255,107,154,.18), transparent 60%),
                  radial-gradient(500px 220px at 85% 10%, rgba(255,209,220,.14), transparent 65%);
      opacity:.7;
      pointer-events:none;
    }

    header{
      position:relative;
      padding:34px 34px 12px;
      z-index:1;
      display:flex;
      gap:18px;
      align-items:center;
      flex-wrap:wrap;
    }
    .kicker{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding:8px 14px;
      border:1px solid rgba(255,255,255,.16);
      border-radius:999px;
      background:rgba(0,0,0,.15);
      font-size:13px;
      letter-spacing:.5px;
      color:var(--muted);
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:linear-gradient(180deg, var(--accent), var(--accent2));
      box-shadow:0 0 18px rgba(255,107,154,.55);
    }
    h1{
      margin:0;
      font-size:clamp(22px, 3.4vw, 34px);
      line-height:1.25;
      font-weight:800;
      letter-spacing:.6px;
      flex:1 1 260px;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
      line-height:1.6;
      width:100%;
    }

    /* ===== Polaroid Style (replaces photo-frame) ===== */
    .polaroid{
      width:112px;
      background:#fff;
      padding:9px 9px 24px; /* bottom space like polaroid */
      border-radius:4px;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transform: rotate(-6deg);
      transition: transform .3s ease;
      flex:0 0 auto;
    }
    .polaroid:hover{
      transform: rotate(-3deg) scale(1.03);
    }
    .polaroid img{
      width:100%;
      height:92px;
      object-fit:cover;
      display:block;
      border-radius:2px;
      filter: saturate(1.05);
    }
    .polaroid-caption{
      margin-top:7px;
      text-align:center;
      color:#222;
      letter-spacing:1px;
      font-family: 'Caveat', "Comic Sans MS", "Brush Script MT", cursive;
      font-size:16px;
      line-height:1;
      user-select:none;
    }

    main{
      position:relative;
      z-index:1;
      padding:14px 34px 34px;
    }
    .letter{
      padding:22px 22px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
    }
    .letter p{
      margin:0 0 14px;
      color: rgba(246,242,255,.92);
      font-size:16px;
      line-height:1.9;
      letter-spacing:.2px;
      text-wrap:pretty;
    }
    .letter p:last-child{margin-bottom:0}

    .signature{
      margin-top:18px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      color:var(--muted);
      font-size:14px;
    }
    .sig-name{
      font-weight:800;
      color:rgba(246,242,255,.92);
      letter-spacing:1px;
    }

    .actions{
      margin-top:18px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
    }
    button{
      appearance:none;
      border:none;
      cursor:pointer;
      padding:10px 14px;
      border-radius:12px;
      color:rgba(246,242,255,.95);
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size:14px;
    }
    button:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.24);
    }
    button.primary{
      background: linear-gradient(135deg, rgba(255,107,154,.85), rgba(255,209,220,.55));
      border-color: rgba(255,107,154,.35);
      box-shadow: 0 10px 30px rgba(255,107,154,.22);
      color:#1b1020;
      font-weight:750;
    }
    button.primary:hover{ transform: translateY(-1px) scale(1.01); }

    .audio-pill{
      display:flex;
      gap:10px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.14);
      color:rgba(216,207,255,.85);
      font-size:13px;
    }
    .audio-pill b{ color:rgba(246,242,255,.92); font-weight:750; }

    footer{
      position:relative;
      z-index:1;
      padding:0 34px 26px;
      color:rgba(216,207,255,.7);
      font-size:12px;
      line-height:1.6;
    }

    /* hearts */
    .hearts{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }
    .heart{
      position:absolute;
      width:12px;height:12px;
      transform: rotate(45deg);
      opacity:.0;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.25));
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:12px;height:12px;
      border-radius:50%;
      background: inherit;
    }
    .heart:before{ left:-6px; top:0;}
    .heart:after{ left:0; top:-6px;}
    @keyframes floatUp{
      0%{ transform: translateY(20px) rotate(45deg) scale(.9); opacity:0;}
      10%{opacity:.55}
      70%{opacity:.35}
      100%{ transform: translateY(-120vh) rotate(45deg) scale(1.15); opacity:0;}
    }

    @media (prefers-reduced-motion: reduce){
      .flap,.paper,.seal,.card{transition:none !important}
      .heart{display:none !important}
    }

    @media print{
      body{ background:#fff; color:#111; }
      body:before, .hearts, .photo-bg, .photo-vignette, .actions, footer, .scene{ display:none !important; }
      .card{ box-shadow:none; border:1px solid #ddd; background:#fff; }
      .letter{ background:#fff; border:1px solid #eee; }
      .letter p, .subtitle, .signature, h1{ color:#111 !important; }
    }
  </style>
</head>

<body>
  <div class="photo-bg" aria-hidden="true"></div>
  <div class="photo-vignette" aria-hidden="true"></div>
  <div class="hearts" id="hearts" aria-hidden="true"></div>

  <div class="wrap">
    <div class="scene">

      <!-- Envelope -->
      <div class="envelope-wrap" id="envelopeWrap" role="button" tabindex="0" aria-label="æ‰“å¼€ä¿¡å°">
        <div class="envelope" id="envelope">
          <div class="env-body"></div>
          <div class="fold-left"></div>
          <div class="fold-right"></div>
          <div class="fold-bottom"></div>
          <div class="paper">
            <div class="paper-title">ç»™é™çš„ä¸€å°ä¿¡</div>
            <div class="paper-line">ç‚¹å‡»ä¿¡å°ï¼Œæ…¢æ…¢æ‰“å¼€ã€‚</div>
            <div class="paper-line" style="opacity:.85">ï¼ˆå¦‚æœéŸ³ä¹æ²¡å“ï¼Œç‚¹ä¸€ä¸‹é¡µé¢å°±ä¼šæ’­æ”¾ï¼‰</div>
          </div>
          <div class="flap"></div>
          <div class="seal"><span>OPEN</span></div>
        </div>
      </div>

      <div class="hint" id="hint">
        è½»è§¦/ç‚¹å‡»ä¿¡å°æ‰“å¼€ã€‚<br/>
        è¿™ä¸€é¡µæœ‰èƒŒæ™¯éŸ³ä¹ï¼šå¦‚æœæµè§ˆå™¨æ‹¦æˆªè‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹ä¸€ä¸‹â€œæ’­æ”¾éŸ³ä¹â€ã€‚
      </div>

      <!-- Letter Card -->
      <article class="card" id="card" role="article" aria-label="æƒ…äººèŠ‚æƒ…ä¹¦">
        <header>
          <!-- Polaroid photo -->
          <div class="polaroid" title="æˆ‘ä»¬çš„ç…§ç‰‡">
            <img src="photo.jpg" alt="photo" />
            <div class="polaroid-caption" id="photoDate"></div>
          </div>

          <div class="kicker"><span class="dot"></span> Valentineâ€™s Day Letter</div>
          <h1>ç»™é™çš„ä¸€å°ä¿¡</h1>
          <p class="subtitle">æƒ…äººèŠ‚å¿«ä¹ã€‚å¸Œæœ›ä½ æ‰“å¼€è¿™ä¸€é¡µæ—¶ï¼Œåƒè¢«æ¸©æŸ”åœ°æŠ±äº†ä¸€ä¸‹ã€‚</p>
        </header>

        <main>
          <section class="letter" id="letter">

            <div class="signature">
              <div>
                <div>â€”â€” <span class="sig-name">ç¥</span></div>
                <div style="opacity:.85;margin-top:6px" id="signedDate"></div>
              </div>
              <div style="opacity:.75">â¤</div>
            </div>
          </section>

          <div class="actions">
            <span class="audio-pill" id="audioStatus">ğŸµ <b>éŸ³ä¹</b>ï¼šå‡†å¤‡æ’­æ”¾â€¦</span>
            <button class="primary" id="playMusic">æ’­æ”¾éŸ³ä¹</button>
            <button id="toggleHearts">å¼€å¯/å…³é—­é£˜è½çˆ±å¿ƒ</button>
            <button id="copyText">å¤åˆ¶æ–‡å­—</button>
            <button id="print">æ‰“å° / ä¿å­˜ä¸ºPDF</button>
          </div>
        </main>

        <footer>
          å°æç¤ºï¼šä½ å¯ä»¥æŠŠè¿™ä¸€é¡µå‘ç»™å¥¹æ‰“å¼€ï¼›æˆ–åœ¨æµè§ˆå™¨é‡Œâ€œæ‰“å° â†’ ä¿å­˜ä¸º PDFâ€ï¼Œå½“ä½œä¸€ä»½å¯ä»¥æ”¶è—çš„ç¤¼ç‰©ã€‚
        </footer>
      </article>
    </div>
  </div>

  <!-- Background music -->
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <script>
    // ===== Dates =====
    (function setDates(){
      const now = new Date();
      const pad = n => String(n).padStart(2,'0');
      const y = now.getFullYear();
      const m = pad(now.getMonth()+1);
      const d = pad(now.getDate());
      const hh = pad(now.getHours());
      const mm = pad(now.getMinutes());
      document.getElementById('signedDate').textContent = `${y}-${m}-${d}  ${hh}:${mm}`;
    })();

    // ===== Photo polaroid handwritten date =====
    (function setPhotoDate(){
      const now = new Date();
      const y = now.getFullYear();
      const m = now.getMonth() + 1;
      const d = now.getDate();
      const el = document.getElementById('photoDate');
      if (el) el.textContent = `${y}.${m}.${d}`;
    })();

    // ===== Hearts =====
    const heartsWrap = document.getElementById('hearts');
    let heartsOn = true;
    let heartTimer = null;
    function random(min, max){ return Math.random()*(max-min)+min; }
    function spawnHeart(){
      const h = document.createElement('div');
      h.className = 'heart';
      const left = random(0, 100);
      const size = random(10, 18);
      const duration = random(6, 12);
      const delay = random(0, 0.5);
      h.style.left = left + 'vw';
      h.style.bottom = '-20px';
      h.style.width = size + 'px';
      h.style.height = size + 'px';
      h.style.animationDuration = duration + 's';
      h.style.animationDelay = delay + 's';
      const palette = [
        'rgba(255,107,154,.65)',
        'rgba(255,209,220,.55)',
        'rgba(255,150,190,.55)',
        'rgba(255,120,160,.50)'
      ];
      h.style.background = palette[Math.floor(Math.random()*palette.length)];
      heartsWrap.appendChild(h);
      const removeAfter = (duration + delay + 0.2) * 1000;
      setTimeout(() => h.remove(), removeAfter);
    }
    function startHearts(){
      if (heartTimer) return;
      heartTimer = setInterval(() => {
        spawnHeart();
        if (Math.random() > 0.65) spawnHeart();
      }, 650);
    }
    function stopHearts(){
      clearInterval(heartTimer);
      heartTimer = null;
      [...heartsWrap.children].forEach((c,i)=> setTimeout(()=>c.remove(), i*40));
    }
    startHearts();
    document.getElementById('toggleHearts').addEventListener('click', () => {
      heartsOn = !heartsOn;
      heartsOn ? startHearts() : stopHearts();
    });

    // ===== Copy & Print =====
    document.getElementById('copyText').addEventListener('click', async () => {
      const text = document.getElementById('letter').innerText.trim();
      try{
        await navigator.clipboard.writeText(text);
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚');
      }catch(e){
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚');
      }
    });
    document.getElementById('print').addEventListener('click', () => window.print());

    // ===== Music =====
    const bgm = document.getElementById('bgm');
    const playBtn = document.getElementById('playMusic');
    const audioStatus = document.getElementById('audioStatus');

    function setAudioStatus(text){ audioStatus.textContent = text; }

    async function tryPlayMusic(){
      try{
        await bgm.play();
        setAudioStatus('ğŸµ éŸ³ä¹ï¼šæ­£åœ¨æ’­æ”¾');
        playBtn.textContent = 'æš‚åœéŸ³ä¹';
      }catch(err){
        setAudioStatus('ğŸµ éŸ³ä¹ï¼šéœ€è¦ç‚¹ä¸€ä¸‹â€œæ’­æ”¾éŸ³ä¹â€');
        playBtn.textContent = 'æ’­æ”¾éŸ³ä¹';
      }
    }

    playBtn.addEventListener('click', async () => {
      if (!bgm.paused){
        bgm.pause();
        setAudioStatus('ğŸµ éŸ³ä¹ï¼šå·²æš‚åœ');
        playBtn.textContent = 'æ’­æ”¾éŸ³ä¹';
        return;
      }
      await tryPlayMusic();
    });

    // iOS/Chrome policy: user gesture needed. We'll try on first user interaction.
    function armFirstGesture(){
      const handler = () => {
        tryPlayMusic();
        window.removeEventListener('pointerdown', handler);
        window.removeEventListener('keydown', handler);
      };
      window.addEventListener('pointerdown', handler, { once:true });
      window.addEventListener('keydown', handler, { once:true });
    }
    armFirstGesture();

    // ===== Envelope Open -> show card =====
    const envelopeWrap = document.getElementById('envelopeWrap');
    const envelope = document.getElementById('envelope');
    const card = document.getElementById('card');
    const hint = document.getElementById('hint');

    let opened = false;
    function openEnvelope(){
      if (opened) return;
      opened = true;

      // start music attempt (gesture)
      tryPlayMusic();

      envelope.classList.add('open');

      // after animation, reveal the letter card
      setTimeout(() => {
        card.classList.add('show');
        hint.style.opacity = 0;
        hint.style.transform = 'translateY(-6px)';
        hint.style.transition = 'opacity 500ms ease, transform 500ms ease';
        // scroll to card on small screens
        card.scrollIntoView({ behavior:'smooth', block:'start' });
      }, 900);
    }

    envelopeWrap.addEventListener('click', openEnvelope);
    envelopeWrap.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') openEnvelope();
    });
  </script>
</body>
</html>

